version: "3.7"

x-logging: &default-logging
  logging:
    driver: "json-file"
    options:
      max-size: "50m"
      max-file: "4"
    tag: "{{.ImageName}}|{{.Name}}|{{.ImageFullID}}|{{.FullID}}"

services:
  '{{ app_name }}':
    <<: *default-logging
    image:  '{{ app_image }}'
    restart: always
    container_name: '{{ app_name }}'
    ports:
        - '{{ external_port }}:{{ internal_port }}'

    healthcheck:
        test:
            - CMD-SHELL
            - curl --fail http://localhost:{{external_port}} || exit 1
        timeout: 10s
        interval: 1m
        retries: 5